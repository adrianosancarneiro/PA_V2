#!/bin/bash

# Load environment variables from .env file
if [ -f "/home/mentorius/AI_Services/PA_V2/.env" ]; then
    echo "Loading credentials from .env file..."
    export $(grep -v '^#' /home/mentorius/AI_Services/PA_V2/.env | xargs)
else
    echo "Error: .env file not found at /home/mentorius/AI_Services/PA_V2/.env"
    exit 1
fi

# Create docker volume for n8n data
docker volume create n8n_data

# Run n8n container with PostgreSQL configuration
docker run -it --rm \
 --name n8n \
 --network="host" \
 -p 5678:5678 \
 -e GENERIC_TIMEZONE="$(timedatectl | grep "Time zone" | awk '{print $3}')" \
 -e TZ="$(timedatectl | grep "Time zone" | awk '{print $3}')" \
 -e N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true \
 -e N8N_RUNNERS_ENABLED=true \
 -e DB_TYPE=postgresdb \
 -e DB_POSTGRESDB_DATABASE="$POSTGRES_DATABASE" \
 -e DB_POSTGRESDB_HOST="$POSTGRES_HOST" \
 -e DB_POSTGRESDB_PORT="$POSTGRES_PORT" \
 -e DB_POSTGRESDB_USER="$POSTGRES_USER" \
 -e DB_POSTGRESDB_SCHEMA="$POSTGRES_SCHEMA" \
 -e DB_POSTGRESDB_PASSWORD="$POSTGRES_PASSWORD" \
 -v n8n_data:/home/node/.n8n \
 docker.n8n.io/n8nio/n8n
